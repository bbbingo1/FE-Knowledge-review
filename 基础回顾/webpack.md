## Webpack

### webpackå’Œgruntã€gulpæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ

webpackæ˜¯ä¸€ä¸ªæ¨¡å—æ‰“åŒ…å·¥å…·ï¼Œå¯ä»¥**é€’å½’**çš„æ‰“åŒ…é¡¹ç›®ä¸­çš„æ‰€æœ‰æ¨¡å—ï¼Œæœ€ç»ˆç”Ÿæˆä¸€ä¸ªæ‰“åŒ…æ–‡ä»¶ï¼Œä»–å’Œå…¶ä»–å·¥å…·æœ€å¤§çš„ä¸åŒåœ¨äºä»–å¯ä»¥æ”¯æŒä»£ç åˆ†å‰²ï¼Œæ¨¡å—åŒ–å’Œå…¨å±€åˆ†æã€‚

### ä»€ä¹ˆæ˜¯loaderï¼Œä»€ä¹ˆæ˜¯plugins

loaderï¼šå¯ä»¥å°†æŸä¸€ç±»å‹çš„æ–‡ä»¶è¿›è¡Œè½¬æ¢ï¼Œå¹¶ä¸”å¼•å…¥åˆ°æ‰“åŒ…å‡ºçš„æ–‡ä»¶ã€‚
pluginsï¼ˆæ’ä»¶ï¼‰ï¼šå¯ä»¥æ‰“åŒ…ä¼˜åŒ–ï¼Œèµ„æºç®¡ç†ï¼Œæ³¨å…¥ç¯å¢ƒå˜é‡ã€‚

#### å‡ ä¸ªå¸¸ç”¨çš„loaderï¼š

1. babel-loaderï¼š è®©ä¸‹ä¸€ä»£çš„jsæ–‡ä»¶è½¬æ¢æˆç°ä»£æµè§ˆå™¨èƒ½å¤Ÿæ”¯æŒçš„JSæ–‡ä»¶ã€‚
   babelæœ‰äº›å¤æ‚ï¼Œæ‰€ä»¥å¤§å¤šæ•°éƒ½ä¼šæ–°å»ºä¸€ä¸ª`.babelrc`è¿›è¡Œé…ç½®
2. css-loader,style-loader:ä¸¤ä¸ªå»ºè®®é…åˆä½¿ç”¨ï¼Œç”¨æ¥è§£æcssæ–‡ä»¶ï¼Œèƒ½å¤Ÿè§£é‡Š`@import,url()`å¦‚æœéœ€è¦è§£ælesså°±åœ¨åé¢åŠ ä¸€ä¸ªless-loader,sassç­‰åŒç†
3. file-loader: ç”Ÿæˆçš„æ–‡ä»¶åå°±æ˜¯æ–‡ä»¶å†…å®¹çš„`MD5`å“ˆå¸Œå€¼å¹¶ä¼šä¿ç•™æ‰€å¼•ç”¨èµ„æºçš„åŸå§‹æ‰©å±•å
4. url-loader: åŠŸèƒ½ç±»ä¼¼ file-loader,ä½†æ˜¯æ–‡ä»¶å¤§å°ä½äºæŒ‡å®šçš„é™åˆ¶æ—¶ï¼Œå¯ä»¥è¿”å›ä¸€ä¸ª`DataURL`ã€‚

#### æœ‰å“ªäº›å¸¸è§çš„Pluginï¼Ÿ

- define-pluginï¼šå®šä¹‰ç¯å¢ƒå˜é‡
- html-webpack-pluginï¼šç®€åŒ–htmlæ–‡ä»¶åˆ›å»º
- uglifyjs-webpack-pluginï¼šé€šè¿‡`UglifyES`å‹ç¼©`ES6`ä»£ç 
- webpack-parallel-uglify-plugin: å¤šæ ¸å‹ç¼©,æé«˜å‹ç¼©é€Ÿåº¦
- webpack-bundle-analyzer: å¯è§†åŒ–webpackè¾“å‡ºæ–‡ä»¶çš„ä½“ç§¯
- mini-css-extract-plugin: CSSæå–åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­,æ”¯æŒæŒ‰éœ€åŠ è½½

### ä»€ä¹ˆæ˜¯moduleï¼Œä»€ä¹ˆæ˜¯Chunkï¼Œä»€ä¹ˆæ˜¯bundle

moduleï¼šå¼€å‘è¿‡ç¨‹ä¸­æ¯ä¸€ä¸ªä¾èµ–çš„æ¨¡å—
chunkï¼šwebpackè¿›è¡Œä¾èµ–åˆ†ææ—¶ã€ä»£ç åˆ†å‰²å‡ºæ¥çš„ä»£ç å—
bundleï¼šæ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶

### WebpackåŠŸèƒ½åŸç†ï¼ˆğŸ”¥ï¼‰

- ä»£ç è½¬æ¢ï¼šTypeScript ç¼–è¯‘æˆ JavaScriptã€SCSS ç¼–è¯‘æˆ CSS ç­‰ç­‰
- æ–‡ä»¶ä¼˜åŒ–ï¼šå‹ç¼© JavaScriptã€CSSã€HTML ä»£ç ï¼Œå‹ç¼©åˆå¹¶å›¾ç‰‡ç­‰
- ä»£ç åˆ†å‰²ï¼šæå–å¤šä¸ªé¡µé¢çš„å…¬å…±ä»£ç ã€æå–é¦–å±ä¸éœ€è¦æ‰§è¡Œéƒ¨åˆ†çš„ä»£ç è®©å…¶å¼‚æ­¥åŠ è½½
- æ¨¡å—åˆå¹¶ï¼šåœ¨é‡‡ç”¨æ¨¡å—åŒ–çš„é¡¹ç›®æœ‰å¾ˆå¤šæ¨¡å—å’Œæ–‡ä»¶ï¼Œéœ€è¦æ„å»ºåŠŸèƒ½æŠŠæ¨¡å—åˆ†ç±»åˆå¹¶æˆä¸€ä¸ªæ–‡ä»¶
- è‡ªåŠ¨åˆ·æ–°ï¼šç›‘å¬æœ¬åœ°æºä»£ç çš„å˜åŒ–ï¼Œè‡ªåŠ¨æ„å»ºï¼Œåˆ·æ–°æµè§ˆå™¨
- ä»£ç æ ¡éªŒï¼šåœ¨ä»£ç è¢«æäº¤åˆ°ä»“åº“å‰éœ€è¦æ£€æµ‹ä»£ç æ˜¯å¦ç¬¦åˆè§„èŒƒï¼Œä»¥åŠå•å…ƒæµ‹è¯•æ˜¯å¦é€šè¿‡
- è‡ªåŠ¨å‘å¸ƒï¼šæ›´æ–°å®Œä»£ç åï¼Œè‡ªåŠ¨æ„å»ºå‡ºçº¿ä¸Šå‘å¸ƒä»£ç å¹¶ä¼ è¾“ç»™å‘å¸ƒç³»ç»Ÿã€‚

### webpackæ„å»ºè¿‡ç¨‹ï¼ˆğŸ”¥ï¼‰

- ä»entryé…ç½®ä¸­é€’å½’è§£æå‡ºä¾èµ–çš„æ‰€æœ‰module
- æ¯ä¸€ä¸ªmoduleéƒ½è°ƒç”¨å¯¹åº”çš„loaderè½¬æ¢è§„åˆ™
- moduleè½¬æ¢å®Œåï¼Œå°±è§£æå½“å‰moduleä¾èµ–çš„å…¶ä»–moduleï¼Œ
- è¿™äº›æ¨¡å—æŒ‰entryä¸ºå•ä½åˆ†ç»„ï¼Œæ¯ä¸€ä¸ªentryå’Œå…¶ä¾èµ–çš„æ‰€æœ‰moduleåˆ†åˆ°ä¸€ä¸ªç»„chunk
- webpackå°†chunkè½¬æ¢ä¸ºæ–‡ä»¶è¾“å‡º
- æ•´ä¸ªè¿‡ç¨‹ä¸­webpackä¼šåœ¨åˆé€‚çš„æ—¶æœºæ‰§è¡Œpluginsï¼ˆæ‰“åŒ…ä¼˜åŒ–ï¼Œèµ„æºç®¡ç†ï¼Œæ³¨å…¥ç¯å¢ƒå˜é‡ç­‰ï¼‰

è¾“å‡ºçš„jsä¸­ï¼švendoråˆ™æ˜¯é€šè¿‡æå–å…¬å…±æ¨¡å—æ’ä»¶æ¥æå–çš„ä»£ç å—ï¼ˆwebpackæœ¬èº«å¸¦çš„æ¨¡å—åŒ–ä»£ç éƒ¨åˆ†ï¼‰ï¼Œè€Œmanifeståˆ™æ˜¯åœ¨vendorçš„åŸºç¡€ä¸Šï¼Œå†æŠ½å–å‡ºè¦ç»å¸¸å˜åŠ¨çš„éƒ¨åˆ†ï¼Œæ¯”å¦‚å…³äºå¼‚æ­¥åŠ è½½jsæ¨¡å—éƒ¨åˆ†çš„å†…å®¹ã€‚

### webpacké…ç½®å¤šé¡µé¢ï¼ˆä¿®æ”¹å…¥å£å’Œè¾“å‡ºï¼‰

```js
//å¤šå…¥å£é…ç½®
// é€šè¿‡globæ¨¡å—è¯»å–pagesæ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰å¯¹åº”æ–‡ä»¶å¤¹ä¸‹çš„jsåç¼€æ–‡ä»¶ï¼Œå¦‚æœè¯¥æ–‡ä»¶å­˜åœ¨
// é‚£ä¹ˆå°±ä½œä¸ºå…¥å£å¤„ç†
exports.entries = function () {
  var entryFiles = glob.sync(PAGE_PATH + '/*/*.js')
  var map = {}
  entryFiles.forEach((filePath) => {
      var filename = filePath.substring(filePath.lastIndexOf('\/') + 1, filePath.lastIndexOf('.'))
      map[filename] = filePath
  })
  return map
}

//å¤šé¡µé¢è¾“å‡ºé…ç½®
// ä¸ä¸Šé¢çš„å¤šé¡µé¢å…¥å£é…ç½®ç›¸åŒï¼Œè¯»å–pagesæ–‡ä»¶å¤¹ä¸‹çš„å¯¹åº”çš„htmlåç¼€æ–‡ä»¶ï¼Œç„¶åæ”¾å…¥æ•°ç»„ä¸­
exports.htmlPlugin = function () {
  let entryHtml = glob.sync(PAGE_PATH + '/*/*.html')
  let arr = []
  entryHtml.forEach((filePath) => {
      let filename = filePath.substring(filePath.lastIndexOf('\/') + 1, filePath.lastIndexOf('.'))
      let conf = {
          // æ¨¡æ¿æ¥æº
          template: filePath,
          // æ–‡ä»¶åç§°
          filename: filename + '.html',
          // é¡µé¢æ¨¡æ¿éœ€è¦åŠ å¯¹åº”çš„jsè„šæœ¬ï¼Œå¦‚æœä¸åŠ è¿™è¡Œåˆ™æ¯ä¸ªé¡µé¢éƒ½ä¼šå¼•å…¥æ‰€æœ‰çš„jsè„šæœ¬
          chunks: ['manifest', 'vendor', filename],
          inject: true
      }
      if (process.env.NODE_ENV === 'production') {
          conf = merge(conf, {
              minify: {
                  removeComments: true,
                  collapseWhitespace: true,
                  removeAttributeQuotes: true
              },
              chunksSortMode: 'dependency'
          })
      }
      arr.push(new HtmlWebpackPlugin(conf))
  })
  return arr
}
```

